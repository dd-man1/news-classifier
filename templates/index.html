<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLMãƒ‹ãƒ¥ãƒ¼ã‚¹åˆ†é¡ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¤– LLMãƒ‹ãƒ¥ãƒ¼ã‚¹åˆ†é¡ã‚¢ãƒ—ãƒª</h1>
            <p>AIãŒãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è‡ªå‹•ã§åˆ†é¡ã—ã¾ã™</p>
        </header>

        <div class="category-filter">
            <button class="category-btn active" data-category="all">å…¨ã¦</button>
            {% for category in categories %}
            <button class="category-btn" data-category="{{ category }}">{{ category }}</button>
            {% endfor %}
        </div>

        <div id="loading" class="loading">
            <p>ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <div id="news-container" class="news-container"></div>
    </div>

    <script>
        let allNews = [];
        let currentCategory = 'all';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—
        window.addEventListener('DOMContentLoaded', async () => {
            await fetchNews();
        });

        // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—
        async function fetchNews() {
            const loading = document.getElementById('loading');
            const container = document.getElementById('news-container');
            
            loading.style.display = 'block';
            container.innerHTML = '';

            try {
                const response = await fetch('/api/news');
                allNews = await response.json();
                loading.style.display = 'none';
                displayNews(allNews);
            } catch (error) {
                loading.style.display = 'none';
                container.innerHTML = '<p class="error">ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                console.error('Error:', error);
            }
        }

        // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¡¨ç¤º
        function displayNews(news) {
            const container = document.getElementById('news-container');
            container.innerHTML = '';

            // ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const filteredNews = currentCategory === 'all' 
                ? news 
                : news.filter(item => item.category === currentCategory);

            if (filteredNews.length === 0) {
                container.innerHTML = '<p class="no-news">è©²å½“ã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            filteredNews.forEach(item => {
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card';
                newsCard.innerHTML = `
                    <div class="news-category">${item.category}</div>
                    <h3 class="news-title">
                        <a href="${item.link}" target="_blank">${item.title}</a>
                    </h3>
                    <p class="news-date">${item.published}</p>
                `;
                container.appendChild(newsCard);
            });
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // ã‚«ãƒ†ã‚´ãƒªã‚’å¤‰æ›´ã—ã¦å†è¡¨ç¤º
                currentCategory = btn.dataset.category;
                displayNews(allNews);
            });
        });
    </script>
</body>
</html>